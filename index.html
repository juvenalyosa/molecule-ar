<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Molecule AR Viewer</title>

  <!-- model-viewer (3D + AR) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root { color-scheme: light; }
    body{
      margin:0; min-height:100vh; display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:14px; font-family:system-ui, Arial, sans-serif;
    }
    h1{ margin:0; font-size:1.15rem; }
    model-viewer{ width:min(92vw, 980px); height:min(70vh, 640px); background:#fff; }
    .toolbar{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:center;
    }
    .btn{
      border:1px solid #ccc; border-radius:10px; padding:.45rem .7rem; background:#fff; cursor:pointer;
      font: 13px/1 system-ui; user-select:none;
    }
    .btn:active{ transform:translateY(1px); }
    .hint{ opacity:.75; font-size:.9rem; }
    a.button{ text-decoration:none; border:1px solid #ccc; border-radius:999px; padding:.5rem .9rem; }
  </style>
</head>
<body>
  <h1>View Molecule in AR</h1>

  <!-- iPhone/iPad: AR Quick Look -->
  <a class="button" rel="ar" href="./molecule.usdz">üëÜ iPhone / iPad: Open in AR</a>

  <!-- 3D viewer (full manipulation) + AR button for Android -->
  <model-viewer id="mv"
    src="./molecule.glb"
    ios-src="./molecule.usdz"
    ar
    ar-modes="quick-look scene-viewer webxr"
    camera-controls            <!-- enables orbit/zoom in the 3D viewer -->
    auto-rotate
    auto-rotate-delay="3000"
    shadow-intensity="1"
    exposure="1.05">
  </model-viewer>

  <!-- Controls for the 3D viewer (not AR mode) -->
  <div class="toolbar">
    <button class="btn" id="rotL">‚ü≤ Left</button>
    <button class="btn" id="rotR">‚ü≥ Right</button>
    <button class="btn" id="rotUp">‚Üë Up</button>
    <button class="btn" id="rotDn">‚Üì Down</button>
    <button class="btn" id="zoIn">Ôºã Zoom In</button>
    <button class="btn" id="zoOut">Ôºç Zoom Out</button>
    <button class="btn" id="reset">Reset</button>
    <button class="btn" id="toggle">‚ñ∂Ô∏é Auto-rotate</button>
  </div>

  <div class="hint">
    3D viewer: drag = rotate ‚Ä¢ wheel/pinch = zoom ‚Ä¢ R = toggle auto-rotate ‚Ä¢ Arrows = rotate ‚Ä¢ +/- = zoom.
    In AR: drag = move ‚Ä¢ pinch = scale ‚Ä¢ twist = rotate (vertical). Walk around to view.
  </div>

  <script>
    const mv = document.getElementById('mv');

    // helpers
    function orbit(dThetaDeg=0, dPhiDeg=0) {
      const o = mv.getCameraOrbit();                 // {theta, phi, radius} in radians/meters
      const clamp = (x, lo, hi) => Math.min(hi, Math.max(lo, x));
      const toRad = d => d * Math.PI / 180;

      const theta = o.theta + toRad(dThetaDeg);
      // keep phi away from 0/œÄ to avoid gimbal lock
      const phi = clamp(o.phi + toRad(dPhiDeg), toRad(5), Math.PI - toRad(5));

      mv.cameraOrbit = `${theta}rad ${phi}rad ${o.radius}`;
      mv.jumpCameraToGoal();
    }

    function zoom(dFovDeg=0) {
      const fov = mv.getFieldOfView();               // degrees
      const nf = Math.min(80, Math.max(10, fov + dFovDeg));
      mv.fieldOfView = `${nf}deg`;
      mv.jumpCameraToGoal();
    }

    function reset() {
      mv.autoRotate = false;
      mv.cameraOrbit = `0deg 75deg 100%`;
      mv.fieldOfView = `45deg`;
      mv.jumpCameraToGoal();
    }

    // buttons
    document.getElementById('rotL').onclick = () => orbit(-15, 0);
    document.getElementById('rotR').onclick = () => orbit( 15, 0);
    document.getElementById('rotUp').onclick = () => orbit(0, -10);
    document.getElementById('rotDn').onclick = () => orbit(0,  10);
    document.getElementById('zoIn').onclick = () => zoom(-5);
    document.getElementById('zoOut').onclick = () => zoom( 5);
    document.getElementById('reset').onclick = reset;
    document.getElementById('toggle').onclick = () => mv.autoRotate = !mv.autoRotate;

    // keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if (k === 'r') mv.autoRotate = !mv.autoRotate;
      else if (e.key === 'ArrowLeft')  orbit(-10, 0);
      else if (e.key === 'ArrowRight') orbit( 10, 0);
      else if (e.key === 'ArrowUp')    orbit(0, -8);
      else if (e.key === 'ArrowDown')  orbit(0,  8);
      else if (k === '+' || e.key === '=') zoom(-4);
      else if (k === '-' )                 zoom( 4);
      else if (k === '0') reset();
    });
  </script>
</body>
</html>
